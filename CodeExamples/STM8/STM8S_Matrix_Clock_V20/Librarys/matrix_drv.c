/**
  ******************************************************************************
  * @File     matrix_drv.c
  * @Author   Pham Van Lap KMT
  * @Version  V1.0
  * @Date     16/01/2017
  * @Brief    This file contains all the functions for the matrix led peripheral.
  ******************************************************************************
**/
#include "matrix_drv.h"
#ifdef Matrix_8x48
uint8_t display_ram[48];
uint8_t display_ram_effect[48];
char Text[400]="00:00:00";
/******************************************************************************/
const uint8_t Font_5x7[96][5] =
{
    0x00, 0x00, 0x00, 0x00, 0x00, // SPACE  32 
    0x00, 0x00, 0x5F, 0x00, 0x00, // !      33
    0x00, 0x03, 0x00, 0x03, 0x00, // "      34
    0x14, 0x3E, 0x14, 0x3E, 0x14, // #      35  
    0x24, 0x2A, 0x7F, 0x2A, 0x12, // $      36
    0x43, 0x33, 0x08, 0x66, 0x61, // %      37  
    0x36, 0x49, 0x55, 0x22, 0x50, // &      38
    0x00, 0x05, 0x03, 0x00, 0x00, // '      39
    0x00, 0x1C, 0x22, 0x41, 0x00, // (      40
    0x00, 0x41, 0x22, 0x1C, 0x00, // )      41
    0x14, 0x08, 0x3E, 0x08, 0x14, // *      42
    0x08, 0x08, 0x3E, 0x08, 0x08, // +      43
    0x00, 0x50, 0x30, 0x00, 0x00, // ,      44
    0x08, 0x08, 0x08, 0x08, 0x08, // -      45
    0x00, 0x60, 0x60, 0x00, 0x00, // .      46
    96, 48, 24, 12, 6, // /      47  
    62, 127, 99, 127, 62, // 0      48
    0, 66, 127, 127, 64, // 1      49
    102, 115, 91, 95, 110, // 2      50
    34, 99, 73, 127, 54, // 3      51
    28, 26, 127, 127, 24, // 4      52
    47, 111, 77, 125, 57, // 5      53
    62, 127, 73, 123, 50, // 6      54
    3, 115, 123, 15, 7, // 7      55
    54, 127, 73, 127, 54, // 8      56
    38, 111, 73, 127, 62, // 9      57
    0x00, 0x36, 0x36, 0x00, 0x00, // :      58
    0x00, 0x56, 0x36, 0x00, 0x00, // ;      59
    0x08, 0x14, 0x22, 0x41, 0x00, // <      60
    0x14, 0x14, 0x14, 0x14, 0x14, // =      61
    0x00, 0x41, 0x22, 0x14, 0x08, // >      62
    0x02, 0x01, 0x51, 0x09, 0x06, // ?      63
    0x3E, 0x41, 0x59, 0x55, 0x5E, // @      64
    126, 127, 27, 127, 126, // A      65
    0x7F, 0x49, 0x49, 0x49, 0x36, // B      66
    0x3E, 0x41, 0x41, 0x41, 0x22, // C      67
    0x7F, 0x41, 0x41, 0x41, 0x3E, // D      68
    0x7F, 0x49, 0x49, 0x49, 0x41, // E      69
    0x7F, 0x09, 0x09, 0x09, 0x01, // F      70
    0x3E, 0x41, 0x41, 0x49, 0x3A, // G      71
    0x7F, 0x08, 0x08, 0x08, 0x7F, // H      72
    0x00, 0x41, 0x7F, 0x41, 0x00, // I      73
    0x30, 0x40, 0x40, 0x40, 0x3F, // J      74
    0x7F, 0x08, 0x14, 0x22, 0x41, // K      75
    127, 127, 96, 96, 96, // L      76
    0x7F, 0x02, 0x0C, 0x02, 0x7F, // M      77
    0x7F, 0x02, 0x04, 0x08, 0x7F, // N      78
    0x3E, 0x41, 0x41, 0x41, 0x3E, // O      79
    0x7F, 0x09, 0x09, 0x09, 0x06, // P      80
    0x1E, 0x21, 0x21, 0x21, 0x5E, // Q      81
    0x7F, 0x09, 0x09, 0x09, 0x76, // R      82
    0x26, 0x49, 0x49, 0x49, 0x32, // S      83
    0x01, 0x01, 0x7F, 0x01, 0x01, // T      84
    0x3F, 0x40, 0x40, 0x40, 0x3F, // U      85
    0x1F, 0x20, 0x40, 0x20, 0x1F, // V      86
    0x7F, 0x20, 0x10, 0x20, 0x7F, // W      87
    0x41, 0x22, 0x1C, 0x22, 0x41, // X      88
    0x07, 0x08, 0x70, 0x08, 0x07, // Y      89
    0x61, 0x51, 0x49, 0x45, 0x43, // Z      90
    0x00, 0x7F, 0x41, 0x00, 0x00, // [      91
    0x02, 0x04, 0x08, 0x10, 0x20, // \      92
    0x00, 0x00, 0x41, 0x7F, 0x00, // ]      93 
    0x04, 0x02, 0x01, 0x02, 0x04, // ^      94
    0x40, 0x40, 0x40, 0x40, 0x40, // _      95
    0x00, 0x01, 0x02, 0x04, 0x00, // `      96   
    0x20, 0x54, 0x54, 0x54, 0x78, // a      97
    0x7F, 0x44, 0x44, 0x44, 0x38, // b      98
    0x38, 0x44, 0x44, 0x44, 0x44, // c      99
    0x38, 0x44, 0x44, 0x44, 0x7F, // d      100
    0x38, 0x54, 0x54, 0x54, 0x18, // e      101
    0x04, 0x04, 0x7E, 0x05, 0x05, // f      102
    0x08, 0x54, 0x54, 0x54, 0x3C, // g      103
    0x7F, 0x08, 0x04, 0x04, 0x78, // h      104
    0x00, 0x44, 0x7D, 0x40, 0x00, // i      105
    0x20, 0x40, 0x44, 0x3D, 0x00, // j      106
    0x7F, 0x10, 0x28, 0x44, 0x00, // k      107
    0x00, 0x41, 0x7F, 0x40, 0x00, // l      108
    0x7C, 0x04, 0x78, 0x04, 0x78, // m      109
    0x7C, 0x08, 0x04, 0x04, 0x78, // n      110
    0x38, 0x44, 0x44, 0x44, 0x38, // o      111
    0x7C, 0x14, 0x14, 0x14, 0x08, // p      112
    0x08, 0x14, 0x14, 0x14, 0x7C, // q      113
    0x00, 0x7C, 0x08, 0x04, 0x04, // r      114
    0x48, 0x54, 0x54, 0x54, 0x20, // s      115
    0x04, 0x04, 0x3F, 0x44, 0x44, // t      116
    0x3C, 0x40, 0x40, 0x20, 0x7C, // u      117
    0x1C, 0x20, 0x40, 0x20, 0x1C, // v      118
    0x3C, 0x40, 0x30, 0x40, 0x3C, // w      119
    0x44, 0x28, 0x10, 0x28, 0x44, // x      120
    0x0C, 0x50, 0x50, 0x50, 0x3C, // y      121
    0x44, 0x64, 0x54, 0x4C, 0x44, // z      122
    0x00, 0x08, 0x36, 0x41, 0x41, // {      123
    0x00, 0x00, 0x7F, 0x00, 0x00, // |      124
    0x41, 0x41, 0x36, 0x08, 0x00, // }      125
    0x02, 0x01, 0x02, 0x04, 0x02, // ~      126
};
/******************************************************************************/
void HC595_Write(uint8_t value)
{
    for(uint8_t i=0; i<8; i++)
    {
        if(((value<<i)&0x80)==0x80)HC595_DATA_HIGH;
        else HC595_DATA_LOW;
        HC595_CLOCK_HIGH;
        HC595_CLOCK_LOW;
    }
}
/******************************************************************************/
void out_data()
{
    HC595_LATCH_HIGH;
    HC595_LATCH_LOW;
}
/******************************************************************************/
void write_data(uint8_t colum_addr)
{
    uint8_t i=0,j=0;
    while(i<6)
    {
        HC595_Write(display_ram[j+colum_addr]);
        j = j+8;
        i++;
    }
}
/******************************************************************************/
void Coppy_Data_To_Ram(uint8_t Line, uint8_t fill)
{
    uint8_t b=0,i=0;
    uint8_t cdata=0;
    uint8_t clm=0;
    while(Text[i]!='\0')
    {
        for(b=0;b<5;b++)
        {
            cdata=Font_5x7[Text[i]-32][b]<<(1-Line);
            if(fill)display_ram[clm+b]=~cdata;
            else display_ram[clm+b]=cdata;
        }
        i++;
        clm = clm+6;
    }
}
/******************************************************************************/
void ColumScroll(uint8_t colum, uint8_t value)
{
    for(uint8_t i=0;i<47;i++)
    {
        display_ram[i]=display_ram[i+1];
    }
    display_ram[47]=~value;
}
/******************************************************************************/
void ScrollTextFont (uint32_t Line, uint32_t speed, uint8_t fill)
{
    uint8_t b=0,i=0;
    uint8_t cdata=0;
    while(Text[i]!='\0')
    {
        for(b=0; b<5; b++)
        {
            cdata=Font_5x7[Text[i]-32][b]<<(1-Line);
            if(fill)ColumScroll(1, cdata);
            else ColumScroll(1, ~cdata);
            delay_us(speed);
        }
        ColumScroll(1, 0x00);
        delay_us(speed);
        i++;
    }
}
/******************************************************************************/
void Clear_Display_Ram(uint8_t fill)
{
    for(uint8_t i=0; i<48; i++)
    {
        if(fill)display_ram[i]=0xff;
        else display_ram[i]=0x00;
    }
}
/******************************************************************************/
void number_time_effect(uint8_t position, uint8_t value, uint8_t step, uint8_t pull, uint8_t Line)
{
    uint8_t cdata=0xff;
    for(uint8_t i=0; i<5; i++)
    {
        cdata=Font_5x7[16+value][i]<<(1-Line);
        if(pull==0)
        {
            display_ram[position+i]=~((~display_ram[position+i]<<1)|(cdata>>step));
        }
        else
        {
            display_ram[position+i]=~((~display_ram[position+i]>>1)|(cdata<<step));
        }
    }
}
#endif
/*******************************************************************************
****************************** END OF FILE *************************************
*******************************************************************************/